/**
 * bootstrap-treetable
 * v1.0.7-beta
 * @author swifly
 * @url https://gitee.com/cyf783/bootstrap-treetable/
 */
 !function(a){var b=function(b,c){this.options=c,this.$el=a(b),this.$el_=this.$el.clone(),this.data_list=null,this.data_obj=null,this.hiddenColumns=[],this.lastAjaxParams,this.hasSelectItem=!1,this.hasFixWidth=!1,this.leftFrozenColumns=[],this.rightFrozenColumns=[],this.noFrozenColumns=[],this.init();var d=this;a(window).resize(function(){d.autoReSize()})};b.prototype.init=function(){this.initContainer(),this.initToolbar(),this.initHeader(),this.initBody(),this.initServer()},b.prototype.initContainer=function(){var b=this,c=a("<div class='bootstrap-tree-table'></div>"),d=a("<div class='treetable-box'></div>"),e=a("<div class='treetable-body-box'></div>");b.$el.before(c),c.append(d),d.append(e),e.append(b.$el),b.$el.addClass("table treetable-table"),b.options.striped&&b.$el.addClass("table-striped"),b.options.bordered&&b.$el.addClass("table-bordered"),b.options.hover&&b.$el.addClass("table-hover"),b.options.condensed&&b.$el.addClass("table-condensed"),b.options.width&&(c.css("width",b.options.width),d.css("width",b.options.width)),b.options.height&&e.css("height",b.options.height),b.$el.html("")},b.prototype.initToolbar=function(){var b,c,d,e,f=this,g=a("<div class='treetable-bars'></div>");f.options.toolbar&&(a(f.options.toolbar).addClass("tool-left"),g.append(a(f.options.toolbar))),b=a('<div class="btn-group tool-right">'),g.append(b),f.$el.parent().parent().before(g),f.options.showRefresh&&(c=a('<button class="btn btn-default btn-outline" type="button" aria-label="refresh" title="刷新"><i class="'+f.options.toolRefreshClass+'"></i></button>'),b.append(c),f.registerRefreshBtnClickEvent(c)),f.options.showColumns?(d=a('<div class="btn-group pull-right" title="列"><button type="button" aria-label="columns" class="btn btn-default btn-outline dropdown-toggle" data-toggle="dropdown" aria-expanded="false"><i class="'+f.options.toolColumnsClass+'"></i> <span class="caret"></span></button></div>'),e=a('<ul class="dropdown-menu dropdown-menu-right columns" role="menu"></ul>'),a.each(f.options.columns,function(b,c){if(!c.checkbox&&!c.radio){var d=null;"undefined"==typeof c.visible||1==c.visible?d=a('<li role="menuitem"><label><input type="checkbox" checked="checked" data-field="'+c.field+'" value="'+c.field+'" > '+c.title+"</label></li>"):(d=a('<li role="menuitem"><label><input type="checkbox" data-field="'+c.field+'" value="'+c.field+'" > '+c.title+"</label></li>"),f.hiddenColumns.push(c.field)),e.append(d)}}),d.append(e),b.append(d),f.registerColumnClickEvent()):a.each(f.options.columns,function(a,b){b.checkbox||b.radio||"undefined"!=typeof b.visible&&1!=b.visible&&f.hiddenColumns.push(b.field)})},b.prototype.initHiddenColumns=function(){var b=this;a.each(b.hiddenColumns,function(a,c){b.$el.parent().parent().parent().find("."+c+"_cls").hide()})},b.prototype.initHeader=function(){var c,d,e,f,g=this,h=a("<tr></tr>");a.each(g.options.columns,function(c,d){d=a.extend({},b.COLUMN_DEFAULTS,d),d.width&&(d.width+=-1==d.width.indexOf("%")&&-1==d.width.indexOf("px")?"px":""),!g.hasFixWidth&&d.width&&(g.hasFixWidth=d.width.indexOf("px")>-1?!0:!1),g.options.columns[c]=d,d.checkbox||d.radio?(g.hasSelectItem=!0,g.leftFrozenColumns.push(d)):d.fixed?"left"==d.fixed?g.leftFrozenColumns.push(d):"right"==d.fixed?g.rightFrozenColumns.push(d):g.noFrozenColumns.push(d):g.noFrozenColumns.push(d)}),c=g.leftFrozenColumns.concat(g.noFrozenColumns).concat(g.rightFrozenColumns),a.each(c,function(b,c){var d;d=0==b&&(c.checkbox||c.radio)?a('<th style="width:36px"></th>'):a('<th style="'+(c.width?"width:"+c.width:"")+'" class="'+c.field+'_cls"></th>'),d.text(c.title),h.append(d)}),d=a('<thead class="treetable-thead"></thead>'),d.append(h),g.$el.append(d),e=a("<div class='treetable-fixed treetable-head-box'></div>"),f=a("<table id='"+g.$el.attr("id")+"_header'></table>"),e.append(f),g.$el.parent().before(e),g.cloneTable(g.$el,f,0,c.length-1),g.$el.find("thead th").each(function(b,c){a(c).html("")}),g.$el.parent().scroll(function(){var a=g.$el.parent().scrollLeft();g.$el.parent().parent().find("#"+g.$el.attr("id")+"_header").parent().css({left:-a})})},b.prototype.initBody=function(){var b=this,c=a('<tbody class="treetable-tbody"></tbody>');b.$el.append(c)},b.prototype.initServer=function(b){var c,d,e=this;e.data_list={},e.data_obj={},c=e.$el.find("tbody"),d='<tr><td colspan="'+e.options.columns.length+'"><div style="display: block;text-align: center;">正在努力地加载数据中，请稍候……</div></td></tr>',c.html(d),e.options.url?a.ajax({type:e.options.type,url:e.options.url,data:b?b:e.options.ajaxParams,dataType:"JSON",success:function(a){e.renderTable(a),e.trigger("load-success",a)},error:function(a,b){var d='<tr><td colspan="'+e.options.columns.length+'"><div style="display: block;text-align: center;">'+a.responseText+"</div></td></tr>";c.html(d),e.trigger("load-error",b,a)}}):e.options.data?(e.renderTable(e.options.data),e.trigger("load-success",e.options.data)):e.trigger("load-error")},b.prototype.renderTable=function(b){var c,d,e=this,f=e.$el.find("tbody");return f.html(""),!b||b.length<=0?(c='<tr><td colspan="'+e.options.columns.length+'"><div style="display: block;text-align: center;">没有找到匹配的记录</div></td></tr>',f.html(c),void 0):(e.formatData(b),d=e.data_list._root_,d&&a.each(d,function(a,b){var c="row_id_"+a;e.recursionNode(b,1,c,"row_root")}),a.each(b,function(a,b){if(!b.isShow){var c=e.renderRow(b,!1,1,"","");f.append(c)}}),e.$el.append(f),e.registerExpanderEvent(),e.registerRowClickEvent(),e.initHiddenColumns(),e.autoReSize(),void 0)},b.prototype.autoReSize=function(){var a=this,b=a.$el.find("thead"),c=a.$el.parent().parent().find("#"+a.$el.attr("id")+"_header"),d=c.find("thead"),e=b.children(":first").width();a.hasScroll(!0)?(c.width(e+a.getScrollWidth()),a.$el.parent().css("border-bottom","1px solid #e7eaec")):(c.width("auto"),a.$el.parent().css("border-bottom","0")),d.css("width",e),a.$el.parent().css("margin-top",c.height())},b.prototype.frozen=function(){var b,c,d,e,f,g,h,i,j,k,l,m,n=this,o=n.$el;o.attr("id"),b=o.parent(),c=b.parent(),d=n.noFrozenColumns.length,e=n.leftFrozenColumns.length,f=n.rightFrozenColumns.length,o.find("td").attr("noWrap","nowrap"),o.width()>c.width()&&(n.leftFrozenColumns.length>0&&(g=a("<div class='treetable-fixed treetable-fixed-l'></div>"),h=a("<div></div>"),n.mergeAttributes(b,h),i=a("<table></table>"),g.append(h),h.append(i),c.append(g),n.cloneTable(n.$el,i,0,e-1),g.css("left",c.offset().left),g.css("top",0),h.height(h.height()-n.getScrollWidth(b[0])),j=a("<div class='treetable-fixed treetable-head-box'></div>"),g.append(j),k=a("<table></table>"),j.append(k),n.cloneTable(c.find("#"+o.attr("id")+"_header"),k,0,e-1)),n.rightFrozenColumns.length>0&&(l=a("<div class='treetable-fixed treetable-fixed-r'></div>"),h=a("<div></div>"),n.mergeAttributes(b,h),m=a("<table></table>"),l.append(h),h.append(m),c.append(l),n.cloneTable(n.$el,m,d+e,d+e+f-1),l.css("right",n.getScrollWidth(b[0])),l.css("top",0),h.height(h.height()-n.getScrollWidth(b[0])),j=a("<div class='treetable-fixed treetable-head-box'></div>"),l.append(j),k=a("<table></table>"),j.append(k),n.cloneTable(c.find("#"+o.attr("id")+"_header"),k,d+e,d+e+f-1)),c.find(".treetable-head-box").each(function(b,c){a(c).css({top:0})})),b.scroll(function(){var d=b.scrollLeft(),e=b.scrollTop();c.find("#"+o.attr("id")+"_header").parent().css({left:-d}),c.find(".treetable-fixed .treetable-body-box").each(function(b,c){a(c).scrollTop(e)})})},b.prototype.cloneTable=function(b,c,d,e){var f,g,h=this;h.mergeAttributes(b,c),b.find("thead")&&b.find("thead").length>0&&(f=a("<thead></thead>"),h.mergeAttributes(b.find("thead"),f),b.find("thead tr").each(function(b,c){var g,i=a("<tr></tr>");h.mergeAttributes(a(c),i),g=0,a(c).find("th").each(function(b,c){b>=d&&e>=b&&(i.append(a(c).clone(!0)),g+=a(c).width())}),f.append(i)}),c.append(f)),b.find("tbody")&&b.find("tbody").length>0&&(g=a("<tbody></tbody>"),h.mergeAttributes(b.find("tbody"),g),b.find("tbody tr").each(function(b,c){var f=a("<tr></tr>");h.mergeAttributes(a(c),f),a(c).find("td").each(function(b,c){b>=d&&e>=b&&f.append(a(c).clone(!0))}),g.append(f)}),c.append(g))},b.prototype.mergeAttributes=function(a,b){for(var c,d=a.get(0).attributes,e=d.length-1;e>=0;e--)if(c=d[e].name,"id"!==c.toLowerCase()&&""!=d[e].value&&null!=d[e].value&&"null"!=d[e].value)try{b.attr(c,d[e].value)}catch(f){}},b.prototype.formatData=function(b){var c=this,d=c.options.rootIdValue?c.options.rootIdValue:null;a.each(b,function(a,b){b.isShow=!1;var e="0"==b[c.options.parentId]||0==b[c.options.parentId]||null==b[c.options.parentId]||""==b[c.options.parentId];!b[c.options.parentId]||(d?b[c.options.parentId]==c.options.rootIdValue:e)?(c.data_list._root_||(c.data_list._root_=[]),c.data_obj["id_"+b[c.options.id]]||c.data_list._root_.push(b)):(c.data_list["_n_"+b[c.options.parentId]]||(c.data_list["_n_"+b[c.options.parentId]]=[]),c.data_obj["id_"+b[c.options.id]]||c.data_list["_n_"+b[c.options.parentId]].push(b)),c.data_obj["id_"+b[c.options.id]]=b})},b.prototype.recursionNode=function(b,c,d,e){var f=this,g=f.$el.find("tbody"),h=f.data_list["_n_"+b[f.options.id]],i=f.renderRow(b,h?!0:!1,c,d,e);g.append(i),h&&a.each(h,function(a,b){var e=d+"_"+a;f.recursionNode(b,c+1,e,d)})},b.prototype.renderRow=function(b,c,d,e,f){var g,h,i,j=this;return b.isShow=!0,b.row_id=e,b.p_id=f,b.lv=d,g=a('<tr id="'+e+'" pid="'+f+'" dataid="'+b[j.options.id]+'"></tr>'),h=j.options.expanderCollapsedClass,j.options.expandAll?(g.css("display","table"),h=j.options.expanderExpandedClass):1==d?(g.css("display","table"),h=j.options.expandFirst?j.options.expanderExpandedClass:j.options.expanderCollapsedClass):2==d?(j.options.expandFirst?g.css("display","table"):g.css("display","none"),h=j.options.expanderCollapsedClass):(g.css("display","none"),h=j.options.expanderCollapsedClass),i=j.leftFrozenColumns.concat(j.noFrozenColumns).concat(j.rightFrozenColumns),a.each(i,function(e,f){var i,k,l;if(f.checkbox||f.radio)i=a('<td style="text-align:center;width:36px"></td>'),f.radio&&(k=a('<input name="select_item" type="radio" value="'+b[j.options.id]+'"></input>'),i.append(k)),f.checkbox&&(k=a('<input name="select_item" type="checkbox" value="'+b[j.options.id]+'"></input>'),i.append(k)),g.append(i);else{if(i=a('<td name="'+f.field+'" class="'+f.field+'_cls"></td>'),f.width&&i.css("width",f.width),f.align&&i.css("text-align",f.align),j.options.expandColumn==e&&i.css("text-align","left"),f.valign&&i.css("vertical-align",f.valign),j.options.showTitle&&i.addClass("ellipsis"),f.formatter?i.html(f.formatter.call(j,b[f.field],b,e)):(j.options.showTitle&&i.attr("title",b[f.field]),i.text(b[f.field])),j.options.expandColumn==e)for(c?i.prepend('<span class="treetable-expander '+h+'"></span>'):i.prepend('<span class="treetable-expander"></span>'),l=0;d-1>l;l++)i.prepend('<span class="treetable-indent"></span>');g.append(i)}}),g},b.prototype.hasScroll=function(a){var b=this,c=b.$el.parent()[0];return a&&c.scrollHeight>c.clientHeight?!0:!a&&c.offsetHeight-c.clientHeight>0?!0:!1},b.prototype.getScrollWidth=function(a){var b=0;return a?b=a.offsetWidth-a.clientWidth:(a=document.createElement("div"),a.style.width="100px",a.style.height="100px",a.style.overflowY="scroll",document.body.appendChild(a),b=a.offsetWidth-a.clientWidth,document.body.removeChild(a)),b},b.prototype.registerRefreshBtnClickEvent=function(b){var c=this;a(b).off("click").on("click",function(){c.refresh()})},b.prototype.registerColumnClickEvent=function(){var b=this;a(".bootstrap-tree-table .treetable-bars .columns label input").off("click").on("click",function(){var c=a(this);c.prop("checked")?b.showColumn(a(this).val()):b.hideColumn(a(this).val())})},b.prototype.registerRowClickEvent=function(){var b=this;b.$el.find("tbody").find("tr").find("td").off("click dblclick").on("click dblclick",function(c){var d,e=a(this),f=e.parent(),g=b.data_obj["id_"+f.attr("dataid")],h=e.attr("name"),i=g[h];b.trigger("click"===c.type?"click-cell":"dbl-click-cell",h,i,g,e),b.trigger("click"===c.type?"click-row":"dbl-click-row",g,f,h),b.hasSelectItem&&(d=f.find("input[name='select_item']"),"radio"==d.attr("type")?(d.prop("checked",!0),b.$el.find("tbody").find("tr").removeClass("treetable-selected"),f.addClass("treetable-selected")):d.prop("checked")?(d.prop("checked",!1),f.removeClass("treetable-selected")):(d.prop("checked",!0),f.addClass("treetable-selected")))})},b.prototype.registerExpanderEvent=function(){var b=this;b.$el.find("tbody").find("tr").find(".treetable-expander").off("click").on("click",function(){var c,d,e,f=a(this).hasClass(b.options.expanderExpandedClass),g=a(this).hasClass(b.options.expanderCollapsedClass);(f||g)&&(c=a(this).parent().parent(),d=c.attr("id"),e=b.$el.find("tbody").find("tr[id^='"+d+"_']"),f?(a(this).removeClass(b.options.expanderExpandedClass),a(this).addClass(b.options.expanderCollapsedClass),e&&e.length>0&&a.each(e,function(b,c){a(c).css("display","none")})):(a(this).removeClass(b.options.expanderCollapsedClass),a(this).addClass(b.options.expanderExpandedClass),e&&e.length>0&&a.each(e,function(c,d){var e=a("#"+a(d).attr("pid")).children().eq(b.options.expandColumn).find(".treetable-expander");e.hasClass(b.options.expanderExpandedClass)&&a(d).css("display","table")})))})},b.prototype.refresh=function(a){var b=this;a&&(b.lastAjaxParams=a),b.initServer(b.lastAjaxParams)},b.prototype.appendData=function(b){var c=this;a.each(b,function(b,d){var e,f,g,h,i,j,k,l,m=c.data_obj["id_"+d[c.options.id]],n=c.data_obj["id_"+d[c.options.parentId]],o=c.data_list["_n_"+d[c.options.parentId]],p="",q="",r=1;m&&m.row_id&&""!=m.row_id&&(p=m.row_id),n?(q=n.row_id,""==p&&(f=0,o&&o.length>0&&(f=o.length),p=n.row_id+"_"+f),r=n.lv+1,e=c.renderRow(d,!1,r,p,q),g=a("#"+n.row_id).children().eq(c.options.expandColumn).find(".treetable-expander"),h=g.hasClass(c.options.expanderExpandedClass),i=g.hasClass(c.options.expanderCollapsedClass),h||i?h&&e.css("display","table"):g.addClass(c.options.expanderCollapsedClass),m?(a("#"+m.row_id).before(e),a("#"+m.row_id).remove()):(j=n.row_id.split("_"),k=n.row_id.substring(0,n.row_id.length-1)+(parseInt(j[j.length-1])+1),a("#"+k).before(e))):(e=c.renderRow(d,!1,r,p,q),m?(a("#"+m.row_id).before(e),a("#"+m.row_id).remove()):(l=c.$el.find("tbody"),l.append(e))),d.isShow=!0,c.formatData([d])}),c.registerExpanderEvent(),c.registerRowClickEvent(),c.initHiddenColumns()},b.prototype.toggleRow=function(b){var c=this,d=c.data_obj["id_"+b],e=a("#"+d.row_id).find(".treetable-expander");e.trigger("click")},b.prototype.expandRow=function(b){var c=this,d=c.data_obj["id_"+b],e=a("#"+d.row_id).find(".treetable-expander"),f=e.hasClass(c.$el.options.expanderCollapsedClass);f&&e.trigger("click")},b.prototype.collapseRow=function(b){var c=this,d=c.data_obj["id_"+b],e=a("#"+d.row_id).find(".treetable-expander"),f=e.hasClass(c.$el.options.expanderExpandedClass);f&&e.trigger("click")},b.prototype.expandAll=function(){var b=this;b.$el.find("tbody").find("tr").find(".treetable-expander").each(function(c,d){var e=a(d).hasClass(b.options.expanderCollapsedClass);e&&a(d).trigger("click")})},b.prototype.collapseAll=function(){var b=this;b.$el.find("tbody").find("tr").find(".treetable-expander").each(function(c,d){var e=a(d).hasClass(b.options.expanderExpandedClass);e&&a(d).trigger("click")})},b.prototype.showColumn=function(b){var c,d=this,e=a.inArray(b,d.hiddenColumns);e>-1&&d.hiddenColumns.splice(e,1),d.$el.parent().parent().parent().find("."+b+"_cls").show(),d.options.showColumns&&(c=a(".bootstrap-tree-table .treetable-bars .columns label").find("input[value='"+b+"']"),c.prop("checked","checked")),d.autoReSize()},b.prototype.hideColumn=function(b){var c,d=this;d.hiddenColumns.push(b),d.$el.parent().parent().parent().find("."+b+"_cls").hide(),d.options.showColumns&&(c=a(".bootstrap-tree-table .treetable-bars .columns label").find("input[value='"+b+"']"),c.prop("checked","")),d.autoReSize()},b.prototype.getSelections=function(){var b,c,d,e=this;return e.hasSelectItem?(b=e.$el.find("tbody").find("tr").find("input[name='select_item']:checked"),c=[],"radio"==b.attr("type")?(d=e.data_obj["id_"+b.val()],c.push(d)):b.each(function(b,d){var f=e.data_obj["id_"+a(d).val()];c.push(f)}),c):void 0},b.prototype.trigger=function(c){var d=this,e=Array.prototype.slice.call(arguments,1);c+=".bs.tree.table",d.options[b.EVENTS[c]].apply(d.options,e),d.$el.trigger(a.Event(c),e),d.options.onAll(c,e),d.$el.trigger(a.Event("all.bs.tree.table"),[c,e])},b.prototype.destroy=function(){var b=this,c=b.$el.parent().parent().parent();b.$el.insertBefore(c),a(b.options.toolbar).insertBefore(b.$el),c.remove(),this.$el.html(this.$el_.html())},b.METHODS=["getSelections","refresh","appendData","toggleRow","expandRow","collapseRow","expandAll","collapseAll","showColumn","hideColumn","destroy"],b.EVENTS={"all.bs.tree.table":"onAll","click-cell.bs.tree.table":"onClickCell","dbl-click-cell.bs.tree.table":"onDblClickCell","click-row.bs.tree.table":"onClickRow","dbl-click-row.bs.tree.table":"onDblClickRow","load-success.bs.tree.table":"onLoadSuccess","load-error.bs.tree.table":"onLoadError"},b.DEFAULTS={id:"id",parentId:"parentId",rootIdValue:null,data:null,type:"GET",url:null,ajaxParams:{},expandColumn:0,expandAll:!1,expandFirst:!0,striped:!1,bordered:!0,hover:!0,condensed:!1,columns:[],toolbar:null,width:0,height:0,showTitle:!0,showColumns:!0,showRefresh:!0,expanderExpandedClass:"bstt-icon bstt-chevron-down",expanderCollapsedClass:"bstt-icon bstt-chevron-right",toolRefreshClass:"bstt-icon bstt-refresh",toolColumnsClass:"bstt-icon bstt-columns",onAll:function(){return!1},onLoadSuccess:function(){return!1},onLoadError:function(){return!1},onClickCell:function(){return!1},onDblClickCell:function(){return!1},onClickRow:function(){return!1},onDblClickRow:function(){return!1}},b.COLUMN_DEFAULTS={radio:!1,checkbox:!1,field:void 0,title:void 0,align:void 0,valign:void 0,width:void 0,visible:!0,fixed:void 0,formatter:void 0},a.fn.bootstrapTreeTable=function(c){var d,e=Array.prototype.slice.call(arguments,1);return this.each(function(){var f=a(this),g=f.data("bootstrap.tree.table"),h=a.extend({},b.DEFAULTS,f.data(),"object"==typeof c&&c);if("string"==typeof c){if(a.inArray(c,b.METHODS)<0)throw new Error("Unknown method: "+c);if(!g)return;d=g[c].apply(g,e),"destroy"===c&&f.removeData("bootstrap.tree.table")}g||f.data("bootstrap.tree.table",g=new b(this,h))}),"undefined"==typeof d?this:d}}(jQuery);